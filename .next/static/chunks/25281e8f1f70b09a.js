(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,23779,e=>{"use strict";e.s(["default",()=>i]);var r=e.i(43476),t=e.i(71645);let s=(0,e.i(57765).generateClient)(),a=["09:00","09:30","10:00","10:30","11:00","11:30"];function i(){let{inviteToken:e,onRegistrationComplete:i,prefillEmail:l}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[n,d]=(0,t.useState)({firstName:"",lastName:"",email:l||"",phone:"",numberOfKids:0,timeSlot:"",needsChildcare:!1,referredBy:"",children:[]}),[o,m]=(0,t.useState)({}),[c,u]=(0,t.useState)({}),[h,g]=(0,t.useState)(!1),[x,f]=(0,t.useState)(!1);(0,t.useEffect)(()=>{b()},[]),(0,t.useEffect)(()=>{let e=[];for(let r=0;r<n.numberOfKids;r++)e.push(n.children[r]||{age:1,gender:"boy"});d(r=>({...r,children:e}))},[n.numberOfKids]);let b=async()=>{try{let{data:e}=await s.models.TimeSlotConfig.list(),r={};e.forEach(e=>{r[e.timeSlot]={max:e.maxCapacity||0,current:e.currentRegistrations||0}}),m(r)}catch(e){console.error("Error loading time slot capacities:",e)}},p=async()=>{let e={};n.firstName.trim()||(e.firstName="First name is required"),n.lastName.trim()||(e.lastName="Last name is required"),n.email.trim()||(e.email="Email is required"),n.phone.trim()||(e.phone="Phone number is required"),n.timeSlot||(e.timeSlot="Please select a time slot"),n.numberOfKids<0&&(e.numberOfKids="Number of kids cannot be negative"),n.numberOfKids>0&&n.children.forEach((r,t)=>{(r.age<1||r.age>18)&&(e["child_".concat(t,"_age")]="Age must be between 1 and 18")});try{let{data:r}=await s.models.Registration.list({filter:{email:{eq:n.email}}});r.length>0&&(e.email="Someone is already registered with this email address")}catch(e){console.error("Error checking email:",e)}try{let{data:r}=await s.models.Registration.list({filter:{phone:{eq:n.phone}}});r.length>0&&(e.phone="Someone is already registered with this phone number")}catch(e){console.error("Error checking phone:",e)}let r=o[n.timeSlot];return r&&r.current>=r.max&&(e.timeSlot="This time slot is full"),u(e),0===Object.keys(e).length},j=async r=>{r.preventDefault(),g(!0);try{if(!await p())return void g(!1);let r=await s.models.Registration.create({firstName:n.firstName,lastName:n.lastName,email:n.email,phone:n.phone,numberOfKids:n.numberOfKids,timeSlot:n.timeSlot,needsChildcare:n.needsChildcare,referredBy:n.referredBy||void 0,inviteToken:e,registrationDate:new Date().toISOString()});if(r.data){n.numberOfKids>0&&await Promise.all(n.children.map(e=>s.models.Child.create({registrationId:r.data.id,age:e.age,gender:e.gender})));let e=o[n.timeSlot];if(e){let{data:r}=await s.models.TimeSlotConfig.list({filter:{timeSlot:{eq:n.timeSlot}}});r[0]&&await s.models.TimeSlotConfig.update({id:r[0].id,currentRegistrations:e.current+1})}f(!0),i&&i()}}catch(e){console.error("Error submitting registration:",e),u({submit:"An error occurred while submitting your registration. Please try again."})}finally{g(!1)}};return x?(0,r.jsx)("div",{className:"max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-md",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-green-600 mb-4",children:"Registration Successful!"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"Thank you for registering for the Christmas Store. You will receive a confirmation email shortly."}),(0,r.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Name:"})," ",n.firstName," ",n.lastName]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Email:"})," ",n.email]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Time Slot:"})," ",n.timeSlot]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Number of Children:"})," ",n.numberOfKids]}),n.needsChildcare&&(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Childcare:"})," Yes"]})]})]})}):(0,r.jsxs)("div",{className:"max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-md",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-center mb-6 text-red-600",children:"Christmas Store Registration"}),(0,r.jsxs)("form",{onSubmit:j,className:"space-y-6",children:[c.submit&&(0,r.jsx)("div",{className:"bg-red-50 p-4 rounded-lg text-red-600",children:c.submit}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name *"}),(0,r.jsx)("input",{type:"text",value:n.firstName,onChange:e=>d(r=>({...r,firstName:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent",required:!0}),c.firstName&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:c.firstName})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name *"}),(0,r.jsx)("input",{type:"text",value:n.lastName,onChange:e=>d(r=>({...r,lastName:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent",required:!0}),c.lastName&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:c.lastName})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address *"}),(0,r.jsx)("input",{type:"email",value:n.email,onChange:e=>d(r=>({...r,email:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent",required:!0}),c.email&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:c.email})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number *"}),(0,r.jsx)("input",{type:"tel",value:n.phone,onChange:e=>d(r=>({...r,phone:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent",required:!0}),c.phone&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:c.phone})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Number of Children (18 and under) *"}),(0,r.jsx)("input",{type:"number",min:"0",max:"20",value:n.numberOfKids,onChange:e=>d(r=>({...r,numberOfKids:parseInt(e.target.value)||0})),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent",required:!0}),c.numberOfKids&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:c.numberOfKids})]}),n.numberOfKids>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Children Information"}),(0,r.jsx)("div",{className:"space-y-4",children:n.children.map((e,t)=>(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Child ",t+1," Age"]}),(0,r.jsx)("input",{type:"number",min:"1",max:"18",value:e.age,onChange:e=>{let r=[...n.children];r[t].age=parseInt(e.target.value)||1,d(e=>({...e,children:r}))},className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent",required:!0}),c["child_".concat(t,"_age")]&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:c["child_".concat(t,"_age")]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Child ",t+1," Gender"]}),(0,r.jsxs)("select",{value:e.gender,onChange:e=>{let r=[...n.children];r[t].gender=e.target.value,d(e=>({...e,children:r}))},className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent",required:!0,children:[(0,r.jsx)("option",{value:"boy",children:"Boy"}),(0,r.jsx)("option",{value:"girl",children:"Girl"})]})]})]},t))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Preferred Time Slot *"}),(0,r.jsxs)("select",{value:n.timeSlot,onChange:e=>d(r=>({...r,timeSlot:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select a time slot"}),a.map(e=>{let t=o[e],s=t&&t.current>=t.max,a=t?" (".concat(t.current,"/").concat(t.max," registered)"):"";return(0,r.jsxs)("option",{value:e,disabled:s,children:[e,a,s?" - FULL":""]},e)})]}),c.timeSlot&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:c.timeSlot})]}),(0,r.jsx)("div",{children:(0,r.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:n.needsChildcare,onChange:e=>d(r=>({...r,needsChildcare:e.target.checked})),className:"rounded border-gray-300 text-red-600 shadow-sm focus:border-red-300 focus:ring focus:ring-red-200 focus:ring-opacity-50"}),(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"I need childcare during my shopping time"})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Were you referred by any agency or person? (optional)"}),(0,r.jsx)("input",{type:"text",value:n.referredBy,onChange:e=>d(r=>({...r,referredBy:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:"Agency name or person's name"})]}),(0,r.jsx)("button",{type:"submit",disabled:h,className:"w-full bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Submitting...":"Register for Christmas Store"})]})]})}}]);