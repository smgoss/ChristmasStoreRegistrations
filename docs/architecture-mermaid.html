<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Christmas Store Registration System - Interactive Diagrams</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .header h1 {
            margin: 0;
            font-size: 3em;
            font-weight: 300;
        }
        .header p {
            margin: 15px 0 0 0;
            opacity: 0.9;
            font-size: 1.2em;
        }
        .diagram-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            overflow: hidden;
        }
        .section-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px 30px;
            font-size: 1.5em;
            font-weight: 500;
        }
        .section-content {
            padding: 30px;
        }
        .diagram-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }
        .nav-buttons {
            text-align: center;
            margin: 30px 0;
        }
        .nav-btn {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 25px;
            margin: 0 10px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        .diagram-description {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            transition: transform 0.2s ease;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .feature-card h4 {
            color: #667eea;
            margin-top: 0;
        }
        .mermaid {
            text-align: center;
        }
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        .control-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            margin: 0 5px;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        .control-btn:hover {
            background: #495057;
        }
        .toc {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .toc h3 {
            margin-top: 0;
            color: #667eea;
        }
        .toc ul {
            list-style: none;
            padding-left: 0;
        }
        .toc li {
            margin: 8px 0;
        }
        .toc a {
            color: #495057;
            text-decoration: none;
            padding: 5px 0;
            display: block;
            transition: color 0.2s ease;
        }
        .toc a:hover {
            color: #667eea;
        }
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            .header h1 {
                font-size: 2em;
            }
            .section-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÑ Christmas Store Registration System</h1>
            <p>Interactive Architecture & Flow Diagrams</p>
        </div>

        <div class="nav-buttons">
            <a href="architecture-drawio.html" class="nav-btn">üìä Draw.io Diagram</a>
            <a href="#architecture" class="nav-btn">üèóÔ∏è Architecture</a>
            <a href="#user-flow" class="nav-btn">üë§ User Flow</a>
            <a href="#admin-flow" class="nav-btn">‚öôÔ∏è Admin Flow</a>
            <a href="#data-model" class="nav-btn">üóÑÔ∏è Data Model</a>
            <a href="#security" class="nav-btn">üîê Security</a>
        </div>

        <div class="toc">
            <h3>üìã Table of Contents</h3>
            <ul>
                <li><a href="#architecture">System Architecture Overview</a></li>
                <li><a href="#user-flow">User Registration Flow</a></li>
                <li><a href="#admin-flow">Admin Management Flow</a></li>
                <li><a href="#data-model">Data Model Relationships</a></li>
                <li><a href="#security">Security & Error Handling</a></li>
            </ul>
        </div>

        <div id="architecture" class="diagram-section">
            <div class="section-header">
                üèóÔ∏è System Architecture Overview
            </div>
            <div class="section-content">
                <div class="diagram-description">
                    <strong>Architecture Overview:</strong> This diagram shows the complete system structure including user layers, frontend components, API routes, AWS Amplify backend, and external service integrations.
                </div>
                
                <div class="controls">
                    <button class="control-btn" onclick="zoomDiagram('arch-diagram', 1.2)">üîç Zoom In</button>
                    <button class="control-btn" onclick="zoomDiagram('arch-diagram', 0.8)">üîç Zoom Out</button>
                    <button class="control-btn" onclick="resetZoom('arch-diagram')">‚Üª Reset</button>
                </div>

                <div class="diagram-container">
                    <div class="mermaid" id="arch-diagram">
graph TB
    %% User Layer
    User[üë§ Users]
    Admin[üõ°Ô∏è Admin Users]

    %% Frontend Layer
    subgraph "Frontend - Next.js 15"
        HomePage[üè† Home Page]
        AdminPage[‚öôÔ∏è Admin Dashboard] 
        RegisterForm[üìù Registration Form]
        Components[üß© Shared Components]
    end

    %% API Layer
    subgraph "API Routes"
        SendInvite[üìß Send Invite API]
        SendConfirm[‚úÖ Send Confirmation API]
        SendSMS[üì± Send SMS API]
        ValidateInvite[üîç Validate Invite API]
    end

    %% AWS Amplify Backend
    subgraph "AWS Amplify Gen 2"
        subgraph "Authentication"
            Cognito[üîê AWS Cognito]
            UserPool[üë• User Pool]
            AdminGroup[üëë Admin Group]
        end
        
        subgraph "Data Layer"
            GraphQL[üîó GraphQL API]
            AppSync[‚ö° AWS AppSync]
            DynamoDB[(üóÑÔ∏è DynamoDB)]
        end
        
        subgraph "Lambda Functions"
            CreateAdmin[üë§ Create Admin User]
            SendInviteFn[üìß Send Invite Email]
            SendConfirmFn[‚úÖ Send Confirmation]
            SendSMSFn[üì± Send SMS]
        end
    end

    %% External Services
    subgraph "External Services"
        SES[üìÆ Amazon SES]
        Clearstream[üì± Clearstream API]
        Zippopotam[üèòÔ∏è Zippopotam API]
        Unsplash[üñºÔ∏è Unsplash Images]
    end

    %% Data Models in DynamoDB
    subgraph "Data Models"
        Registration[(üìã Registration)]
        TimeSlot[(‚è∞ TimeSlot)]
        RegConfig[(‚öôÔ∏è RegistrationConfig)]
    end

    %% User Interactions
    User --> HomePage
    User --> RegisterForm
    Admin --> AdminPage
    Admin --> Cognito

    %% Frontend to API
    RegisterForm --> SendInvite
    RegisterForm --> SendConfirm
    RegisterForm --> SendSMS
    RegisterForm --> ValidateInvite

    %% API to Backend
    SendInvite --> SendInviteFn
    SendConfirm --> SendConfirmFn
    SendSMS --> SendSMSFn

    %% Backend Data Flow
    GraphQL --> AppSync
    AppSync --> DynamoDB
    DynamoDB --> Registration
    DynamoDB --> TimeSlot
    DynamoDB --> RegConfig

    %% Authentication Flow
    Cognito --> UserPool
    UserPool --> AdminGroup
    CreateAdmin --> UserPool

    %% External Service Integration
    SendInviteFn --> SES
    SendConfirmFn --> SES
    SendSMSFn --> Clearstream
    RegisterForm --> Zippopotam
    Components --> Unsplash

    %% Styling
    classDef userClass fill:#e1f5fe
    classDef frontendClass fill:#f3e5f5
    classDef apiClass fill:#fff3e0
    classDef backendClass fill:#e8f5e8
    classDef externalClass fill:#fce4ec
    classDef dataClass fill:#f1f8e9

    class User,Admin userClass
    class HomePage,AdminPage,RegisterForm,Components frontendClass
    class SendInvite,SendConfirm,SendSMS,ValidateInvite apiClass
    class Cognito,UserPool,AdminGroup,GraphQL,AppSync,CreateAdmin,SendInviteFn,SendConfirmFn,SendSMSFn backendClass
    class SES,Clearstream,Zippopotam,Unsplash externalClass
    class Registration,TimeSlot,RegConfig,DynamoDB dataClass
                    </div>
                </div>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>üé® Frontend Components</h4>
                        <p>Next.js 15 with TypeScript, featuring the main registration form, admin dashboard, and shared UI components.</p>
                    </div>
                    <div class="feature-card">
                        <h4>üîó API Integration</h4>
                        <p>RESTful API routes handling registration submissions, email/SMS notifications, and invite validation.</p>
                    </div>
                    <div class="feature-card">
                        <h4>‚òÅÔ∏è AWS Backend</h4>
                        <p>Amplify Gen 2 with GraphQL API, Lambda functions, and DynamoDB for scalable data management.</p>
                    </div>
                    <div class="feature-card">
                        <h4>üåê External Services</h4>
                        <p>Integrated with Amazon SES, Clearstream, Zippopotam, and Unsplash for enhanced functionality.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="user-flow" class="diagram-section">
            <div class="section-header">
                üë§ User Registration Flow
            </div>
            <div class="section-content">
                <div class="diagram-description">
                    <strong>Registration Process:</strong> Complete sequence diagram showing how users interact with the system from initial page visit through successful registration and confirmation.
                </div>

                <div class="controls">
                    <button class="control-btn" onclick="zoomDiagram('user-flow-diagram', 1.2)">üîç Zoom In</button>
                    <button class="control-btn" onclick="zoomDiagram('user-flow-diagram', 0.8)">üîç Zoom Out</button>
                    <button class="control-btn" onclick="resetZoom('user-flow-diagram')">‚Üª Reset</button>
                </div>

                <div class="diagram-container">
                    <div class="mermaid" id="user-flow-diagram">
sequenceDiagram
    participant U as üë§ User
    participant RF as üìù Registration Form
    participant API as üîó API Routes
    participant GQL as ‚ö° GraphQL/AppSync
    participant DB as üóÑÔ∏è DynamoDB
    participant SES as üìÆ Amazon SES
    participant SMS as üì± Clearstream

    Note over U,SMS: Christmas Store Registration Process

    U->>RF: Visit registration page
    RF->>GQL: Load registration config
    GQL->>DB: Query RegistrationConfig
    DB-->>GQL: Return config data
    GQL-->>RF: Registration settings
    
    alt Registration Closed
        RF-->>U: Show "Registration Closed" message
    else Invite Only Mode
        U->>RF: Enter invite token
        RF->>API: Validate invite token
        API->>GQL: Query invitation
        GQL->>DB: Check token validity
        DB-->>API: Token validation result
        API-->>RF: Validation response
        
        alt Invalid Token
            RF-->>U: Show error message
        else Valid Token
            RF-->>U: Show registration form
        end
    else Open Registration
        RF-->>U: Show registration form directly
    end

    Note over U,SMS: Registration Submission

    U->>RF: Fill registration form
    RF->>API: Validate postal code
    API->>+Zippopotam: Check postal code
    Zippopotam-->>-API: Location data
    API-->>RF: Validation result

    U->>RF: Submit registration
    RF->>API: Submit registration data
    API->>GQL: Create registration mutation
    GQL->>DB: Store registration
    DB-->>GQL: Registration created
    GQL-->>API: Success response
    API-->>RF: Registration confirmed

    par Send Email Confirmation
        API->>SES: Send confirmation email
        SES-->>U: Email delivered
    and Send SMS Confirmation
        API->>SMS: Send SMS confirmation
        SMS-->>U: SMS delivered
    end

    RF-->>U: Show success message
                    </div>
                </div>
            </div>
        </div>

        <div id="admin-flow" class="diagram-section">
            <div class="section-header">
                ‚öôÔ∏è Admin Management Flow
            </div>
            <div class="section-content">
                <div class="diagram-description">
                    <strong>Admin Operations:</strong> Comprehensive flowchart showing all administrative capabilities including user management, settings configuration, and data export.
                </div>

                <div class="controls">
                    <button class="control-btn" onclick="zoomDiagram('admin-flow-diagram', 1.2)">üîç Zoom In</button>
                    <button class="control-btn" onclick="zoomDiagram('admin-flow-diagram', 0.8)">üîç Zoom Out</button>
                    <button class="control-btn" onclick="resetZoom('admin-flow-diagram')">‚Üª Reset</button>
                </div>

                <div class="diagram-container">
                    <div class="mermaid" id="admin-flow-diagram">
flowchart TD
    A[üõ°Ô∏è Admin Login] --> B{Authenticated?}
    B -->|No| C[üîê Login with Cognito]
    B -->|Yes| D[‚öôÔ∏è Admin Dashboard]
    
    C --> E{Login Successful?}
    E -->|No| F[‚ùå Show Error]
    E -->|Yes| D
    
    D --> G[üìä View Registrations]
    D --> H[‚öôÔ∏è Update Settings]
    D --> I[üìß Send Invitations]
    D --> J[‚è∞ Manage Time Slots]
    
    G --> K[üìã Registration List]
    K --> L[üìÑ Export Data]
    K --> M[‚úèÔ∏è Edit Registration]
    
    H --> N[üíå Update Contact Info]
    H --> O[üéØ Toggle Registration Mode]
    H --> P[üìÖ Set Event Dates]
    
    I --> Q[üìù Create Invite Tokens]
    Q --> R[üìß Send Invite Emails]
    
    J --> S[‚ûï Add Time Slots]
    J --> T[‚úèÔ∏è Edit Time Slots]
    J --> U[‚ùå Delete Time Slots]
    
    %% Save actions
    N --> V[üíæ Save to DynamoDB]
    O --> V
    P --> V
    S --> V
    T --> V
    M --> V
    
    V --> W[‚úÖ Success Notification]
    
    %% Styling
    classDef adminClass fill:#e3f2fd
    classDef actionClass fill:#fff3e0
    classDef dataClass fill:#f1f8e9
    classDef successClass fill:#e8f5e8
    
    class A,C,D adminClass
    class G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U actionClass
    class V dataClass
    class W successClass
                    </div>
                </div>
            </div>
        </div>

        <div id="data-model" class="diagram-section">
            <div class="section-header">
                üóÑÔ∏è Data Model Relationships
            </div>
            <div class="section-content">
                <div class="diagram-description">
                    <strong>Database Schema:</strong> Entity relationship diagram showing all DynamoDB models, their fields, and relationships within the system.
                </div>

                <div class="controls">
                    <button class="control-btn" onclick="zoomDiagram('data-model-diagram', 1.2)">üîç Zoom In</button>
                    <button class="control-btn" onclick="zoomDiagram('data-model-diagram', 0.8)">üîç Zoom Out</button>
                    <button class="control-btn" onclick="resetZoom('data-model-diagram')">‚Üª Reset</button>
                </div>

                <div class="diagram-container">
                    <div class="mermaid" id="data-model-diagram">
erDiagram
    Registration {
        string id PK
        string firstName
        string lastName
        string email
        string phone
        string address
        string city
        string state
        string postalCode
        string country
        string timeSlotId FK
        string emergencyContactName
        string emergencyContactPhone
        int adultCount
        int childCount
        string dietaryRestrictions
        string specialRequests
        datetime createdAt
        datetime updatedAt
    }
    
    TimeSlot {
        string id PK
        datetime startTime
        datetime endTime
        int maxCapacity
        int currentCount
        boolean isAvailable
        string description
        datetime createdAt
        datetime updatedAt
    }
    
    RegistrationConfig {
        string id PK
        boolean isOpen
        boolean isInviteOnly
        string replyToEmail
        string contactPhone
        datetime eventStartDate
        datetime eventEndDate
        datetime registrationOpenDate
        datetime registrationCloseDate
        string welcomeMessage
        string closedMessage
        datetime createdAt
        datetime updatedAt
    }
    
    Invitation {
        string id PK
        string token
        string email
        boolean isUsed
        datetime expiresAt
        string createdBy
        datetime createdAt
        datetime usedAt
    }

    Registration ||--|| TimeSlot : "belongs to"
    Registration }o--|| RegistrationConfig : "uses config"
    Invitation ||--o| Registration : "enables registration"
                    </div>
                </div>
            </div>
        </div>

        <div id="security" class="diagram-section">
            <div class="section-header">
                üîê Security & Error Handling
            </div>
            <div class="section-content">
                <div class="diagram-description">
                    <strong>Security Architecture:</strong> Multi-layered security approach including authentication, authorization, input validation, and comprehensive error handling.
                </div>

                <div class="controls">
                    <button class="control-btn" onclick="zoomDiagram('security-diagram', 1.2)">üîç Zoom In</button>
                    <button class="control-btn" onclick="zoomDiagram('security-diagram', 0.8)">üîç Zoom Out</button>
                    <button class="control-btn" onclick="resetZoom('security-diagram')">‚Üª Reset</button>
                </div>

                <div class="diagram-container">
                    <div class="mermaid" id="security-diagram">
flowchart TB
    subgraph "Security Layers"
        A[üîê AWS Cognito Authentication]
        B[üëë Admin Group Authorization]
        C[üõ°Ô∏è API Route Protection]
        D[‚úÖ Zod Input Validation]
        E[üö´ Rate Limiting]
    end
    
    subgraph "Error Handling"
        F[üìä Standardized Error Responses]
        G[üìù Comprehensive Logging]
        H[üîÑ Retry Mechanisms]
        I[‚ùå Graceful Degradation]
    end
    
    subgraph "Data Protection"
        J[üîí Encrypted Data at Rest]
        K[üö¶ HTTPS in Transit]
        L[üé≠ No Sensitive Data in Logs]
        M[‚è∞ Token Expiration]
    end
    
    A --> B
    B --> C
    C --> D
    D --> E
    
    E --> F
    F --> G
    G --> H
    H --> I
    
    I --> J
    J --> K
    K --> L
    L --> M
    
    classDef securityClass fill:#ffebee
    classDef errorClass fill:#fff3e0
    classDef dataClass fill:#e8f5e8
    
    class A,B,C,D,E securityClass
    class F,G,H,I errorClass
    class J,K,L,M dataClass
                    </div>
                </div>
            </div>
        </div>

        <div class="nav-buttons">
            <a href="#top" class="nav-btn">‚Üë Back to Top</a>
            <a href="architecture-drawio.html" class="nav-btn">üìä View Draw.io Diagram</a>
        </div>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#333',
                primaryBorderColor: '#764ba2',
                lineColor: '#495057',
                secondaryColor: '#f8f9fa',
                tertiaryColor: '#e9ecef'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            },
            sequence: {
                useMaxWidth: true,
                wrap: true
            },
            er: {
                useMaxWidth: true
            }
        });

        // Zoom functionality
        let zoomLevels = {};

        function zoomDiagram(diagramId, factor) {
            if (!zoomLevels[diagramId]) {
                zoomLevels[diagramId] = 1;
            }
            zoomLevels[diagramId] *= factor;
            
            const diagram = document.getElementById(diagramId);
            const svg = diagram.querySelector('svg');
            if (svg) {
                svg.style.transform = `scale(${zoomLevels[diagramId]})`;
                svg.style.transformOrigin = 'center';
            }
        }

        function resetZoom(diagramId) {
            zoomLevels[diagramId] = 1;
            const diagram = document.getElementById(diagramId);
            const svg = diagram.querySelector('svg');
            if (svg) {
                svg.style.transform = 'scale(1)';
            }
        }

        // Smooth scrolling for navigation
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Add loading animation for diagrams
        document.addEventListener('DOMContentLoaded', function() {
            const diagrams = document.querySelectorAll('.mermaid');
            diagrams.forEach(diagram => {
                diagram.style.opacity = '0';
                diagram.style.transition = 'opacity 0.5s ease-in-out';
            });

            setTimeout(() => {
                diagrams.forEach((diagram, index) => {
                    setTimeout(() => {
                        diagram.style.opacity = '1';
                    }, index * 200);
                });
            }, 500);
        });
    </script>
</body>
</html>