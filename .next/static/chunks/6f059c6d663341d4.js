(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,23779,e=>{"use strict";e.s(["default",()=>i]);var r=e.i(43476),t=e.i(71645);let s=(0,e.i(57765).generateClient)(),a=["09:00","09:30","10:00","10:30","11:00","11:30"];function i(){let{inviteToken:e,onRegistrationComplete:i,prefillEmail:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[l,d]=(0,t.useState)({firstName:"",lastName:"",email:n||"",phone:"",numberOfKids:0,timeSlot:"",needsChildcare:!1,referredBy:"",children:[]}),[o,c]=(0,t.useState)({}),[m,u]=(0,t.useState)({}),[h,g]=(0,t.useState)(!1),[x,f]=(0,t.useState)(!1);(0,t.useEffect)(()=>{b()},[]),(0,t.useEffect)(()=>{let e=[];for(let r=0;r<l.numberOfKids;r++)e.push(l.children[r]||{age:1,gender:"boy"});d(r=>({...r,children:e}))},[l.numberOfKids]);let b=async()=>{try{let{data:e}=await s.models.TimeSlotConfig.list(),r={};e.forEach(e=>{r[e.timeSlot]={max:e.maxCapacity||0,current:e.currentRegistrations||0}}),c(r)}catch(e){console.error("Error loading time slot capacities:",e)}},p=async()=>{let e={};l.firstName.trim()||(e.firstName="First name is required"),l.lastName.trim()||(e.lastName="Last name is required"),l.email.trim()||(e.email="Email is required"),l.phone.trim()||(e.phone="Phone number is required"),l.timeSlot||(e.timeSlot="Please select a time slot"),l.numberOfKids<0&&(e.numberOfKids="Number of kids cannot be negative"),l.numberOfKids>0&&l.children.forEach((r,t)=>{(r.age<1||r.age>18)&&(e["child_".concat(t,"_age")]="Age must be between 1 and 18")});try{let{data:r}=await s.models.Registration.list({filter:{email:{eq:l.email}}});r.length>0&&(e.email="Someone is already registered with this email address")}catch(e){console.error("Error checking email:",e)}try{let{data:r}=await s.models.Registration.list({filter:{phone:{eq:l.phone}}});r.length>0&&(e.phone="Someone is already registered with this phone number")}catch(e){console.error("Error checking phone:",e)}let r=o[l.timeSlot];return r&&r.current>=r.max&&(e.timeSlot="This time slot is full"),u(e),0===Object.keys(e).length},j=async r=>{r.preventDefault(),g(!0);try{if(!await p())return void g(!1);let r=await s.models.Registration.create({firstName:l.firstName,lastName:l.lastName,email:l.email,phone:l.phone,numberOfKids:l.numberOfKids,timeSlot:l.timeSlot,needsChildcare:l.needsChildcare,referredBy:l.referredBy||void 0,inviteToken:e,registrationDate:new Date().toISOString()});if(r.data){l.numberOfKids>0&&await Promise.all(l.children.map(e=>s.models.Child.create({registrationId:r.data.id,age:e.age,gender:e.gender})));let e=o[l.timeSlot];if(e){let{data:r}=await s.models.TimeSlotConfig.list({filter:{timeSlot:{eq:l.timeSlot}}});r[0]&&await s.models.TimeSlotConfig.update({id:r[0].id,currentRegistrations:e.current+1})}f(!0),i&&i()}}catch(e){console.error("Error submitting registration:",e),u({submit:"An error occurred while submitting your registration. Please try again."})}finally{g(!1)}};return x?(0,r.jsx)("div",{className:"max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-md",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-green-600 mb-4",children:"Registration Successful!"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"Thank you for registering for the Christmas Store. You will receive a confirmation email shortly."}),(0,r.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Name:"})," ",l.firstName," ",l.lastName]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Email:"})," ",l.email]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Time Slot:"})," ",l.timeSlot]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Number of Children:"})," ",l.numberOfKids]}),l.needsChildcare&&(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Childcare:"})," Yes"]})]})]})}):(0,r.jsxs)("div",{className:"max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-md",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-center mb-6 text-red-600",children:"Christmas Store Registration"}),(0,r.jsxs)("form",{onSubmit:j,className:"space-y-6",children:[m.submit&&(0,r.jsx)("div",{className:"bg-red-50 p-4 rounded-lg text-red-600",children:m.submit}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name *"}),(0,r.jsx)("input",{type:"text",value:l.firstName,onChange:e=>d(r=>({...r,firstName:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent",required:!0}),m.firstName&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:m.firstName})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name *"}),(0,r.jsx)("input",{type:"text",value:l.lastName,onChange:e=>d(r=>({...r,lastName:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent",required:!0}),m.lastName&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:m.lastName})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address *"}),(0,r.jsx)("input",{type:"email",value:l.email,onChange:e=>d(r=>({...r,email:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent",required:!0}),m.email&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:m.email})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number *"}),(0,r.jsx)("input",{type:"tel",value:l.phone,onChange:e=>d(r=>({...r,phone:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent",required:!0}),m.phone&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:m.phone})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Number of Children (18 and under) *"}),(0,r.jsx)("input",{type:"number",min:"0",max:"20",value:l.numberOfKids,onChange:e=>d(r=>({...r,numberOfKids:parseInt(e.target.value)||0})),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent",required:!0}),m.numberOfKids&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:m.numberOfKids})]}),l.numberOfKids>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Children Information"}),(0,r.jsx)("div",{className:"space-y-4",children:l.children.map((e,t)=>(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Child ",t+1," Age"]}),(0,r.jsx)("input",{type:"number",min:"1",max:"18",value:e.age,onChange:e=>{let r=[...l.children];r[t].age=parseInt(e.target.value)||1,d(e=>({...e,children:r}))},className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent",required:!0}),m["child_".concat(t,"_age")]&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:m["child_".concat(t,"_age")]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Child ",t+1," Gender"]}),(0,r.jsxs)("select",{value:e.gender,onChange:e=>{let r=[...l.children];r[t].gender=e.target.value,d(e=>({...e,children:r}))},className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent",required:!0,children:[(0,r.jsx)("option",{value:"boy",children:"Boy"}),(0,r.jsx)("option",{value:"girl",children:"Girl"})]})]})]},t))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Preferred Time Slot *"}),(0,r.jsxs)("select",{value:l.timeSlot,onChange:e=>d(r=>({...r,timeSlot:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select a time slot"}),a.map(e=>{let t=o[e],s=t&&t.current>=t.max,a=t?" (".concat(t.current,"/").concat(t.max," registered)"):"";return(0,r.jsxs)("option",{value:e,disabled:s,children:[e,a,s?" - FULL":""]},e)})]}),m.timeSlot&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:m.timeSlot})]}),(0,r.jsx)("div",{children:(0,r.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:l.needsChildcare,onChange:e=>d(r=>({...r,needsChildcare:e.target.checked})),className:"rounded border-gray-300 text-red-600 shadow-sm focus:border-red-300 focus:ring focus:ring-red-200 focus:ring-opacity-50"}),(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"I need childcare during my shopping time"})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Were you referred by any agency or person? (optional)"}),(0,r.jsx)("input",{type:"text",value:l.referredBy,onChange:e=>d(r=>({...r,referredBy:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:"Agency name or person's name"})]}),(0,r.jsx)("button",{type:"submit",disabled:h,className:"w-full bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Submitting...":"Register for Christmas Store"})]})]})}},18566,(e,r,t)=>{r.exports=e.r(76562)},55166,e=>{"use strict";e.s(["default",()=>l]);var r=e.i(43476),t=e.i(71645),s=e.i(18566),a=e.i(57765),i=e.i(23779);let n=(0,a.generateClient)();function l(){let e=(0,s.useParams)(),a=(0,s.useRouter)(),l=e.token,[d,o]=(0,t.useState)(null),[c,m]=(0,t.useState)(!0),[u,h]=(0,t.useState)("");(0,t.useEffect)(()=>{l&&g()},[l]);let g=async()=>{try{let{data:e}=await n.models.InviteLink.list({filter:{token:{eq:l}}});if(0===e.length)o(!1);else{let r=e[0];r.isUsed?o(!1):(o(!0),h(r.email||""))}}catch(e){console.error("Error validating token:",e),o(!1)}finally{m(!1)}},x=async()=>{try{let{data:e}=await n.models.InviteLink.list({filter:{token:{eq:l}}});if(e.length>0){let r=e[0];await n.models.InviteLink.update({id:r.id,isUsed:!0,usedAt:new Date().toISOString()})}}catch(e){console.error("Error marking token as used:",e)}};return c?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-green-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Validating invitation..."})]})}):!1===d?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-green-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"max-w-md mx-auto bg-white rounded-lg shadow-md p-8 text-center",children:[(0,r.jsx)("div",{className:"text-red-500 mb-4",children:(0,r.jsx)("svg",{className:"mx-auto h-16 w-16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.704-.833-2.464 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Invalid or Expired Invitation"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"This invitation link is no longer valid. It may have already been used or has expired."}),(0,r.jsx)("button",{onClick:()=>a.push("/"),className:"bg-red-600 text-white px-6 py-3 rounded-md hover:bg-red-700 transition-colors",children:"Go to Main Page"})]})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-green-50 py-12 px-4",children:[(0,r.jsx)("div",{className:"max-w-2xl mx-auto mb-8",children:(0,r.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-green-800 mb-2",children:"You're Invited!"}),(0,r.jsxs)("p",{className:"text-green-700",children:["You have been specially invited to register for the Christmas Store event.",u&&(0,r.jsxs)("span",{className:"block mt-1",children:["Invitation sent to: ",(0,r.jsx)("strong",{children:u})]})]})]})}),(0,r.jsx)(i.default,{inviteToken:l,onRegistrationComplete:x,prefillEmail:u})]})}}]);